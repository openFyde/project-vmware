From 514aeaec7567f894ef2b145ac782e412b420a078 Mon Sep 17 00:00:00 2001
From: "Kristian H. Kristensen" <hoegsberg@chromium.org>
Date: Tue, 6 Sep 2016 15:20:25 -0700
Subject: [PATCH libdrm 6/7] CHROMIUM: drm_fourcc.h: Add Rockchip AFBC modifier
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Old-BUG=chrome-os-partner:56407
Old-TEST=drm-tests null_platform_test with AFBC support

Reviewed-on: https://chromium-review.googlesource.com/387205
Commit-Ready: Kristian H. Kristensen <hoegsberg@chromium.org>
Tested-by: Kristian H. Kristensen <hoegsberg@chromium.org>
Reviewed-by: St√©phane Marchesin <marcheu@chromium.org>
Reviewed-by: Anders Pedersen <anders.pedersen@arm.com>
(rebased from chromeos-2.4.87)

BUG=b:112720782
Signed-off-by: Kristian H. Kristensen <hoegsberg@chromium.org>

Change-Id: Id0d35736047e1fede88c1ce844d834262c7db2ef
---
 include/drm/drm_fourcc.h  | 17 +++++++++++++++++
 tests/modetest/modetest.c |  2 ++
 2 files changed, 19 insertions(+)

diff --git a/include/drm/drm_fourcc.h b/include/drm/drm_fourcc.h
index d4e92d1f..4b146d7a 100644
--- a/include/drm/drm_fourcc.h
+++ b/include/drm/drm_fourcc.h
@@ -189,6 +189,9 @@ extern "C" {
 
 #define DRM_FORMAT_RESERVED	      ((1ULL << 56) - 1)
 
+/* Vendor ID for downstream, interim ChromeOS specific modifiers. */
+#define DRM_FORMAT_MOD_VENDOR_CHROMEOS 0xf0
+
 #define fourcc_mod_code(vendor, val) \
 	((((__u64)DRM_FORMAT_MOD_VENDOR_## vendor) << 56) | ((val) & 0x00ffffffffffffffULL))
 
@@ -407,6 +410,20 @@ extern "C" {
  */
 #define DRM_FORMAT_MOD_BROADCOM_VC4_T_TILED fourcc_mod_code(BROADCOM, 1)
 
+/*
+ * Rockchip ARM Framebuffer Compression (AFBC)
+ *
+ * This modifier identifies the specific variant of AFBC supported by the
+ * Rockchip display hardware. It's technically a two-plane format: first a
+ * header with 16 bytes per block, followed by the block data aligned to 1024
+ * bytes. Each block is 16x16 pixels.
+ *
+ * Eventually ARM should define modifiers for the various AFBC types, but
+ * we'll use this in the meantime. We use the CHROMEOS vendor ID to make sure
+ * we don't clash with future vendor modifiers.
+ */
+#define DRM_FORMAT_MOD_CHROMEOS_ROCKCHIP_AFBC	fourcc_mod_code(CHROMEOS, 1)
+
 #if defined(__cplusplus)
 }
 #endif
diff --git a/tests/modetest/modetest.c b/tests/modetest/modetest.c
index 975dcbcd..c31df981 100644
--- a/tests/modetest/modetest.c
+++ b/tests/modetest/modetest.c
@@ -293,6 +293,8 @@ static const char *modifier_to_string(uint64_t modifier)
 		return "NVIDIA_16BX2_BLOCK(5)";
 	case DRM_FORMAT_MOD_BROADCOM_VC4_T_TILED:
 		return "MOD_BROADCOM_VC4_T_TILED";
+	case DRM_FORMAT_MOD_CHROMEOS_ROCKCHIP_AFBC:
+		return "MOD_CHROMEOS_ROCKCHIP_AFBC";
 	default:
 		return "(UNKNOWN MODIFIER)";
 	}
-- 
2.16.4

